;-------------------------------------------------
;병의 요구의 처리
;ARG:0은 상대의 세력 번호, ARG:1은 요구의 무게. 요구를 마시면 1, 거절하면 0을 돌려준다
;-------------------------------------------------
@DIPLOMACTY_REQUESTED_SOLDIER(ARG:0, ARG:1)
;상대 세력의 군주의 캐릭터 번호를 취득
LOCAL:5 = GET_COUNTRY_BOSS(ARG:0)

LOCAL:12 = GET_SUM_SOLDIER(CFLAG:MASTER:소속)
LOCAL:13 = GET_SUM_ARMY_DF(CFLAG:MASTER:소속)
IF ARG:1 == 0
	LOCAL:11 = MIN(GET_SUM_ECONOMY(CFLAG:MASTER:소속) * 3 / 1000, LOCAL:12 / 2)
ELSEIF ARG:1 == 1
	LOCAL:11 = MIN(GET_SUM_ECONOMY(CFLAG:MASTER:소속) * 8 / 1000, LOCAL:12 * 2 / 3)
ELSE
	LOCAL:11 = MIN(GET_SUM_ECONOMY(CFLAG:MASTER:소속) * 20 / 1000, LOCAL:12)
ENDIF
PRINTFORML %조사처리(ANAME(LOCAL:5),"는")%, 이쪽의 제안을 받아들이는 대가로 병력 {LOCAL:11}을 요구했다
PRINTFORML 현재 총 병력수:{LOCAL:12}(우리의 미할당 병력 수:{COUNTRY_SOLDIER:(CFLAG:MASTER:소속)})
IF LOCAL:11 > COUNTRY_SOLDIER:(CFLAG:MASTER:소속)
	IF LOCAL:11 > COUNTRY_SOLDIER:(CFLAG:MASTER:소속) + LOCAL:13
		PRINTFORML ※요구병력이 현재 미할당 병력 수보다 많기 때문에, 모든 부대를 해산하고 도시방위에 배치된 병력도 넘겨줘야 합니다
	ELSE
		PRINTFORML ※요구병력이 현재 미할당 병력 수보다 많기 때문에, 도시방위에 배치된 병력을 넘겨줘야 합니다
	ENDIF
ENDIF
WAIT
CALL ASK_YN("받아들인다", "거절한다")
IF RESULT != 0
	RETURN 0
ENDIF

IF LOCAL:11 > COUNTRY_SOLDIER:(CFLAG:MASTER:소속)
	IF LOCAL:11 > COUNTRY_SOLDIER:(CFLAG:MASTER:소속) + LOCAL:13
		CALL CLEAR_ALL_UNIT(CFLAG:MASTER:소속)
	ENDIF

	FOR LOCAL:0, 0, MAX_CITY
		IF CITY_OWNER:(LOCAL:0) == CFLAG:MASTER:소속
			COUNTRY_SOLDIER:(CFLAG:MASTER:소속) += CITY_SOLDIER:(LOCAL:0)
			CITY_SOLDIER:(LOCAL:0) = 0
		ENDIF
	NEXT

	COUNTRY_SOLDIER:(CFLAG:MASTER:소속) = MAX(COUNTRY_SOLDIER:(CFLAG:MASTER:소속) - LOCAL:11, 0)

	FOR LOCAL:0, 0, MAX_CITY
		IF CITY_OWNER:(LOCAL:0) == CFLAG:MASTER:소속
			LOCAL:15 = MIN(COUNTRY_SOLDIER:(CFLAG:MASTER:소속), 500)
			CITY_SOLDIER:(LOCAL:0) += LOCAL:15
			COUNTRY_SOLDIER:(CFLAG:MASTER:소속) -= LOCAL:15
		ENDIF
	NEXT

ELSE
	COUNTRY_SOLDIER:(CFLAG:MASTER:소속) = MAX(COUNTRY_SOLDIER:(CFLAG:MASTER:소속) - LOCAL:11, 0)
ENDIF

COUNTRY_SOLDIER:(ARG:0) += LOCAL:11

RETURN 1

